id: storageTestFailed
args:
  - name: operation
    type: Atom
x-erl-to_json: |
  to_json(?ERR_STORAGE_TEST_FAILED(ErrorCtx, Operation)) ->
      #{
          <<"id">> => ?ERR_STORAGE_TEST_FAILED_ID,
          <<"ctx">> => od_error:ctx_to_json(ErrorCtx),
          <<"details">> => #{<<"operation">> => str_utils:to_binary(Operation)},
          <<"description">> => od_error:format_description("Failed to ~ts test file on storage.", [Operation])
      }.
x-erl-from_json: |
  from_json(ErrorJson = #{<<"id">> := ?ERR_STORAGE_TEST_FAILED_ID, <<"details">> := #{<<"operation">> := Operation}}) when
      Operation == <<"read">>;
      Operation == <<"write">>;
      Operation == <<"remove">>
  ->
      ErrorCtxJson = maps:get(<<"ctx">>, ErrorJson, #{}),
      ErrorCtx = od_error:ctx_from_json(ErrorCtxJson),

      ?ERR_STORAGE_TEST_FAILED(ErrorCtx, binary_to_atom(Operation, utf8)).
description: >-
  Failed to {operation} test file on storage.
http_code: 400
errno: EIO
